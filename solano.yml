# Solano CI testing script

# Specify NodeJS versions: http://docs.solanolabs.com/ConfiguringLanguage/nodejs/
nodejs:
  version: '6.5'

# Build setup http://docs.solanolabs.com/Setup/setup-hooks/
hooks:
  pre_setup: |
    set -o errexit -o pipefail  # Exit on error
    # Install yarn if it isn't already present
    if [ ! -d $HOME/.yarn ]; then
      curl -o- -L https://yarnpkg.com/install.sh | bash
    fi
    mkdir -p $HOME/bin  # Automatically in $PATH on workers
    ln -fs $HOME/.yarn/bin/yarn $HOME/bin/yarn
    yarn --version
    # Install packages using yarn
    yarn install

# Include $HOME/.yarn in cache
# http://docs.solanolabs.com/Setup/caching-dependencies/
cache:
  key_paths:
    - package.json
    #- yarn.lock  # to freeze packages installed by yarn
  save_paths:
    - REPO/node_modules  # Repo's "local" cache
    - HOME/.yarn         # Yarn's "global" cache

tests:
  - yarn run test-ci
